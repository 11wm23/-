<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>航线抽签器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(to right, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .airport-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
            position: relative;
        }
        
        .airport {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            width: 45%;
            transition: all 0.3s ease;
        }
        
        .airport:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .airport h2 {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .airport-code {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a5568;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .airport-name {
            font-size: 1rem;
            color: #718096;
        }
        
        .arrow {
            font-size: 2rem;
            color: #a0aec0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        /* 已添加机场列表样式 */
        .airports-list-container {
            margin-top: 30px;
        }
        
        .airports-list-container h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .airports-list {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .airport-item {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }
        
        .airport-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .airport-item-code {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1rem;
        }
        
        .airport-item-name {
            font-size: 0.9rem;
            margin-top: 3px;
        }
        
        .airport-item-country {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 2px;
        }
        
        /* 历史记录样式 */
        .history {
            margin-top: 30px;
        }
        
        .history h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .history-list {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        /* 归属提示样式 */
        .owner-info {
            margin-top: 30px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            text-align: center;
            font-style: italic;
            color: #000000;
            font-size: 0.9rem;
        }
        
        /* 国家选择样式 */
        .country-selection {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* 头部操作按钮 */
        .header-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn-small {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(102, 126, 234, 0.3);
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover,
        .close:focus {
            color: #667eea;
            text-decoration: none;
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.warning {
            background-color: rgba(255, 165, 0, 0.1);
            color: #facc15;
            border: 1px solid #facc15;
        }
        
        .selection-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .selection-group label {
            font-size: 1rem;
            color: #4a5568;
            font-weight: 500;
        }
        
        .country-select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            color: #4a5568;
            cursor: pointer;
            width: 100%;
            max-width: 200px;
            transition: all 0.3s ease;
        }
        
        .country-select:hover {
            border-color: #667eea;
        }
        
        .country-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        @media (max-width: 500px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .airport-display {
                flex-direction: column;
                gap: 20px;
            }
            
            .airport {
                width: 100%;
            }
            
            .arrow {
                transform: rotate(90deg);
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>航线抽签器</h1>
        
        <!-- 移除了登录和添加机场功能 -->
        
        <div class="country-selection">
            <div class="selection-group">
                <label for="departure-country">选择起飞机场国家：</label>
                <select id="departure-country" class="country-select"></select>
            </div>
            <div class="selection-group">
                <label for="arrival-country">选择降落机场国家：</label>
                <select id="arrival-country" class="country-select"></select>
            </div>
        </div>
        
        <!-- 机型选择 -->
        <div style="margin-bottom: 20px;">
            <div class="selection-group">
                <label for="aircraft-type">选择机型：</label>
                <select id="aircraft-type" class="country-select">
                    <!-- 波音737系列 -->
                    <option value="B737-300">波音737-300</option>
                    <option value="B737-400">波音737-400</option>
                    <option value="B737-500">波音737-500</option>
                    <option value="B737-600">波音737-600</option>
                    <option value="B737-700">波音737-700</option>
                    <option value="B737-800">波音737-800</option>
                    <option value="B737-900">波音737-900</option>
                    <option value="B737-900ER">波音737-900ER</option>
                    <option value="B737-MAX7">波音737 MAX 7</option>
                    <option value="B737-MAX8">波音737 MAX 8</option>
                    <option value="B737-MAX9">波音737 MAX 9</option>
                    <option value="B737-MAX10">波音737 MAX 10</option>
                    
                    <!-- 波音747系列 -->
                    <option value="B747-200">波音747-200</option>
                    <option value="B747-300">波音747-300</option>
                    <option value="B747-400">波音747-400</option>
                    <option value="B747-400ER">波音747-400ER</option>
                    <option value="B747-8">波音747-8</option>
                    
                    <!-- 波音757系列 -->
                    <option value="B757-200">波音757-200</option>
                    <option value="B757-300">波音757-300</option>
                    
                    <!-- 波音767系列 -->
                    <option value="B767-200">波音767-200</option>
                    <option value="B767-300">波音767-300</option>
                    <option value="B767-400ER">波音767-400ER</option>
                    
                    <!-- 波音777系列 -->
                    <option value="B777-200">波音777-200</option>
                    <option value="B777-200ER">波音777-200ER</option>
                    <option value="B777-300">波音777-300</option>
                    <option value="B777-300ER">波音777-300ER</option>
                    <option value="B777-F">波音777F (货机)</option>
                    <option value="B777X">波音777X</option>
                    
                    <!-- 波音787系列 -->
                    <option value="B787-8">波音787-8</option>
                    <option value="B787-9">波音787-9</option>
                    <option value="B787-10">波音787-10</option>
                    
                    <!-- 空客A300系列 -->
                    <option value="A300B4">空客A300B4</option>
                    <option value="A300-600">空客A300-600</option>
                    
                    <!-- 空客A310系列 -->
                    <option value="A310-200">空客A310-200</option>
                    <option value="A310-300">空客A310-300</option>
                    
                    <!-- 空客A320系列 -->
                    <option value="A318">空客A318</option>
                    <option value="A319">空客A319</option>
                    <option value="A320">空客A320</option>
                    <option value="A320neo">空客A320neo</option>
                    <option value="A321">空客A321</option>
                    <option value="A321neo">空客A321neo</option>
                    
                    <!-- 空客A330系列 -->
                    <option value="A330-200">空客A330-200</option>
                    <option value="A330-300">空客A330-300</option>
                    <option value="A330neo-800">空客A330neo-800</option>
                    <option value="A330neo-900">空客A330neo-900</option>
                    
                    <!-- 空客A340系列 -->
                    <option value="A340-200">空客A340-200</option>
                    <option value="A340-300">空客A340-300</option>
                    <option value="A340-500">空客A340-500</option>
                    <option value="A340-600">空客A340-600</option>
                    
                    <!-- 空客A350系列 -->
                    <option value="A350-800">空客A350-800</option>
                    <option value="A350-900">空客A350-900</option>
                    <option value="A350-1000">空客A350-1000</option>
                    
                    <!-- 空客A380系列 -->
                    <option value="A380-800">空客A380-800</option>
                    
                    <!-- 其他制造商 -->
                    <option value="MD80">麦道MD-80</option>
                    <option value="MD90">麦道MD-90</option>
                    <option value="MD11">麦道MD-11</option>
                    <option value="E170">巴西航空E170</option>
                    <option value="E175">巴西航空E175</option>
                    <option value="E190">巴西航空E190</option>
                    <option value="E195">巴西航空E195</option>
                    <option value="CRJ700">庞巴迪CRJ700</option>
                    <option value="CRJ900">庞巴迪CRJ900</option>
                    <option value="CRJ1000">庞巴迪CRJ1000</option>
                    <option value="CS100">庞巴迪CS100 (A220-100)</option>
                    <option value="CS300">庞巴迪CS300 (A220-300)</option>
                    <option value="ATR42">ATR 42</option>
                    <option value="ATR72">ATR 72</option>
                </select>
            </div>
        </div>
        
        <div class="airport-display">
            <div class="airport" id="departure-airport">
                <h2>起飞机场</h2>
                <div class="airport-code">---</div>
                <div class="airport-name">点击抽签开始</div>
            </div>
            
            <div class="arrow">➤</div>
            
            <div class="airport" id="arrival-airport">
                <h2>降落机场</h2>
                <div class="airport-code">---</div>
                <div class="airport-name">点击抽签开始</div>
            </div>
        </div>
        
        <button class="btn" id="draw-btn">抽签</button>
        
        <div class="history">
            <h3>历史记录</h3>
            <div class="history-list" id="history-list">
                <!-- 历史记录将在这里显示 -->
            </div>
        </div>
        
        <!-- 归属提示 -->
        <div class="owner-info">
            此抽取器为虚拟LMJ（长征）集团所有
        </div>
    </div>

    <!-- 移除了登录和添加机场模态框 -->

    <script>
        // 默认机场数据
        const defaultAirports = [
            { code: "ZBAA", name: "北京首都国际机场", country: "中国" },
            { code: "ZSPD", name: "上海浦东国际机场", country: "中国" },
            { code: "ZGGG", name: "广州白云国际机场", country: "中国" },
            { code: "ZGSZ", name: "深圳宝安国际机场", country: "中国" },
            { code: "VHHH", name: "香港国际机场", country: "中国香港" },
            { code: "RCTP", name: "台湾桃园国际机场", country: "中国台湾" },
            { code: "RJAA", name: "东京成田国际机场", country: "日本" },
            { code: "RJTT", name: "东京羽田国际机场", country: "日本" },
            { code: "RJBB", name: "大阪关西国际机场", country: "日本" },
            { code: "RKSI", name: "首尔仁川国际机场", country: "韩国" },
            { code: "VTBS", name: "曼谷素万那普国际机场", country: "泰国" },
            { code: "WSSS", name: "新加坡樟宜国际机场", country: "新加坡" },
            { code: "VIDP", name: "新德里英迪拉·甘地国际机场", country: "印度" },
            { code: "OMDB", name: "迪拜国际机场", country: "阿联酋" },
            { code: "EGLL", name: "伦敦希斯罗国际机场", country: "英国" },
            { code: "LFPG", name: "巴黎戴高乐国际机场", country: "法国" },
            { code: "EDDF", name: "法兰克福国际机场", country: "德国" },
            { code: "EHAM", name: "阿姆斯特丹史基浦机场", country: "荷兰" },
            { code: "LEMD", name: "马德里巴拉哈斯机场", country: "西班牙" },
            { code: "LEBL", name: "巴塞罗那埃尔普拉特机场", country: "西班牙" },
            { code: "LIMC", name: "米兰马尔彭萨机场", country: "意大利" },
            { code: "LIRF", name: "罗马菲乌米奇诺机场", country: "意大利" },
            { code: "LTBA", name: "伊斯坦布尔阿塔图尔克机场", country: "土耳其" },
            { code: "KJFK", name: "纽约肯尼迪国际机场", country: "美国" },
            { code: "KLAX", name: "洛杉矶国际机场", country: "美国" },
            { code: "KORD", name: "芝加哥奥黑尔国际机场", country: "美国" },
            { code: "KDFW", name: "达拉斯-沃思堡国际机场", country: "美国" },
            { code: "KATL", name: "亚特兰大哈茨菲尔德-杰克逊国际机场", country: "美国" },
            { code: "CYYZ", name: "多伦多皮尔逊国际机场", country: "加拿大" },
            { code: "MMMX", name: "墨西哥城国际机场", country: "墨西哥" },
            { code: "SBGR", name: "圣保罗瓜鲁柳斯国际机场", country: "巴西" },
            { code: "SAEZ", name: "布宜诺斯艾利斯埃塞萨国际机场", country: "阿根廷" },
            { code: "YSSY", name: "悉尼金斯福德·史密斯国际机场", country: "澳大利亚" },
            { code: "YMML", name: "墨尔本国际机场", country: "澳大利亚" },
            { code: "NZAA", name: "奥克兰国际机场", country: "新西兰" },
            { code: "YPPH", name: "珀斯国际机场", country: "澳大利亚" },
            { code: "WIII", name: "雅加达苏加诺-哈达国际机场", country: "印度尼西亚" },
            { code: "WMKK", name: "吉隆坡国际机场", country: "马来西亚" },
            { code: "RPLL", name: "马尼拉尼诺伊·阿基诺国际机场", country: "菲律宾" },
            { code: "WADD", name: "巴厘岛登巴萨国际机场", country: "印度尼西亚" }
        ];

        // 从localStorage加载机场数据（简易数据库实现）
        let airports = [];
        
        // 从localStorage加载机场数据
        function loadAirportsFromStorage() {
            const storedAirports = localStorage.getItem('airports');
            if (storedAirports) {
                try {
                    airports = JSON.parse(storedAirports);
                    console.log('成功从本地数据库加载', airports.length, '个机场数据');
                } catch (error) {
                    console.error('加载机场数据失败，使用默认数据:', error);
                    airports = [...defaultAirports];
                    saveAirportsToStorage();
                }
            } else {
                // 如果没有存储的数据，使用默认数据
                airports = [...defaultAirports];
                saveAirportsToStorage();
            }
        }
        
        // 保存机场数据到localStorage
        function saveAirportsToStorage() {
            try {
                localStorage.setItem('airports', JSON.stringify(airports));
                console.log('机场数据已保存到本地数据库');
            } catch (error) {
                console.error('保存机场数据失败:', error);
            }
        }
        
        // 批量导入机场数据函数
        function importAirports(airportList) {
            let importedCount = 0;
            
            airportList.forEach(newAirport => {
                // 检查机场是否已存在（不区分大小写）
                const exists = airports.some(airport => 
                    airport.code.toUpperCase() === newAirport.code.toUpperCase()
                );
                
                if (!exists) {
                    // 补充完整的机场数据格式
                    const fullAirportData = {
                        code: newAirport.code.toUpperCase(),
                        name: newAirport.name,
                        country: newAirport.country || "中国", // 默认国家为中国
                        addedBy: "system",
                        addedAt: new Date().toISOString()
                    };
                    
                    airports.push(fullAirportData);
                    importedCount++;
                }
            });
            
            if (importedCount > 0) {
                // 保存更新后的数据
                saveAirportsToStorage();
                // 更新国家列表
                updateCountries();
                console.log(`成功导入 ${importedCount} 个新机场`);
            }
            
            return importedCount;
        }
        
        // 预定义的机场数据（用户提供的中国机场列表）
        const additionalAirports = [
            { code: "ZBNY", name: "北京南苑机场", country: "中国" },
            { code: "ZBAA", name: "北京首都国际机场", country: "中国" },
            { code: "ZBTJ", name: "天津滨海国际机场", country: "中国" },
            { code: "ZBZJ", name: "张家口宁远机场", country: "中国" },
            { code: "ZBHD", name: "邯郸机场", country: "中国" },
            { code: "ZBSH", name: "秦皇岛山海关机场", country: "中国" },
            { code: "ZBTS", name: "唐山三女河机场", country: "中国" },
            { code: "ZBXT", name: "邢台褡裢机场", country: "中国" },
            { code: "ZBSJ", name: "石家庄正定国际机场", country: "中国" },
            { code: "ZBYN", name: "太原武宿国际机场", country: "中国" },
            { code: "ZBLL", name: "吕梁机场", country: "中国" },
            { code: "ZBCZ", name: "长治王村机场", country: "中国" },
            { code: "ZBDT", name: "大同云冈机场", country: "中国" },
            { code: "ZBYC", name: "运城机场", country: "中国" },
            { code: "ZBOW", name: "包头二里半机场", country: "中国" },
            { code: "ZBCF", name: "赤峰玉龙机场", country: "中国" },
            { code: "ZBDS", name: "鄂尔多斯伊金霍洛机场", country: "中国" },
            { code: "ZBER", name: "二连浩特赛乌苏机场", country: "中国" },
            { code: "ZBMZ", name: "满洲里西郊机场", country: "中国" },
            { code: "ZBUH", name: "乌海机场", country: "中国" },
            { code: "ZBES", name: "阿尔山伊尔施机场", country: "中国" },
            { code: "ZBYZ", name: "巴彦淖尔天吉泰机场", country: "中国" },
            { code: "ZBHH", name: "呼和浩特白塔国际机场", country: "中国" },
            { code: "ZBLA", name: "呼伦贝尔海拉尔机场", country: "中国" },
            { code: "ZSSS", name: "上海虹桥国际机场", country: "中国" },
            { code: "ZSPD", name: "上海浦东国际机场", country: "中国" }
        ];
        
        // 初始化国家数组（将在initializeApp中赋值）
        let countries = [];
        
        // 机型数据（包含巡航速度，单位：公里/小时）
        const aircraftTypes = {
            // 波音737系列
            'B737-300': { name: '波音737-300', cruiseSpeed: 828, range: 4175 },
            'B737-400': { name: '波音737-400', cruiseSpeed: 828, range: 4175 },
            'B737-500': { name: '波音737-500', cruiseSpeed: 828, range: 3900 },
            'B737-600': { name: '波音737-600', cruiseSpeed: 828, range: 5648 },
            'B737-700': { name: '波音737-700', cruiseSpeed: 828, range: 6038 },
            'B737-800': { name: '波音737-800', cruiseSpeed: 840, range: 5665 },
            'B737-900': { name: '波音737-900', cruiseSpeed: 828, range: 5925 },
            'B737-900ER': { name: '波音737-900ER', cruiseSpeed: 828, range: 6570 },
            'B737-MAX7': { name: '波音737 MAX 7', cruiseSpeed: 840, range: 6570 },
            'B737-MAX8': { name: '波音737 MAX 8', cruiseSpeed: 840, range: 6570 },
            'B737-MAX9': { name: '波音737 MAX 9', cruiseSpeed: 840, range: 6570 },
            'B737-MAX10': { name: '波音737 MAX 10', cruiseSpeed: 840, range: 6300 },
            
            // 波音747系列
            'B747-200': { name: '波音747-200', cruiseSpeed: 935, range: 9200 },
            'B747-300': { name: '波音747-300', cruiseSpeed: 935, range: 10800 },
            'B747-400': { name: '波音747-400', cruiseSpeed: 917, range: 14205 },
            'B747-400ER': { name: '波音747-400ER', cruiseSpeed: 917, range: 14815 },
            'B747-8': { name: '波音747-8', cruiseSpeed: 917, range: 14815 },
            
            // 波音757系列
            'B757-200': { name: '波音757-200', cruiseSpeed: 850, range: 7275 },
            'B757-300': { name: '波音757-300', cruiseSpeed: 850, range: 6421 },
            
            // 波音767系列
            'B767-200': { name: '波音767-200', cruiseSpeed: 851, range: 9400 },
            'B767-300': { name: '波音767-300', cruiseSpeed: 851, range: 10600 },
            'B767-400ER': { name: '波音767-400ER', cruiseSpeed: 851, range: 10415 },
            
            // 波音777系列
            'B777-200': { name: '波音777-200', cruiseSpeed: 905, range: 9695 },
            'B777-200ER': { name: '波音777-200ER', cruiseSpeed: 905, range: 14260 },
            'B777-300': { name: '波音777-300', cruiseSpeed: 905, range: 11165 },
            'B777-300ER': { name: '波音777-300ER', cruiseSpeed: 905, range: 14685 },
            'B777-F': { name: '波音777F (货机)', cruiseSpeed: 905, range: 9065 },
            'B777X': { name: '波音777X', cruiseSpeed: 905, range: 16110 },
            
            // 波音787系列
            'B787-8': { name: '波音787-8', cruiseSpeed: 903, range: 13620 },
            'B787-9': { name: '波音787-9', cruiseSpeed: 903, range: 14140 },
            'B787-10': { name: '波音787-10', cruiseSpeed: 903, range: 11910 },
            
            // 空客A300系列
            'A300B4': { name: '空客A300B4', cruiseSpeed: 890, range: 6350 },
            'A300-600': { name: '空客A300-600', cruiseSpeed: 890, range: 7400 },
            
            // 空客A310系列
            'A310-200': { name: '空客A310-200', cruiseSpeed: 890, range: 8300 },
            'A310-300': { name: '空客A310-300', cruiseSpeed: 890, range: 9600 },
            
            // 空客A320系列
            'A318': { name: '空客A318', cruiseSpeed: 828, range: 6000 },
            'A319': { name: '空客A319', cruiseSpeed: 828, range: 6850 },
            'A320': { name: '空客A320', cruiseSpeed: 828, range: 5700 },
            'A320neo': { name: '空客A320neo', cruiseSpeed: 840, range: 6300 },
            'A321': { name: '空客A321', cruiseSpeed: 828, range: 5600 },
            'A321neo': { name: '空客A321neo', cruiseSpeed: 840, range: 7400 },
            
            // 空客A330系列
            'A330-200': { name: '空客A330-200', cruiseSpeed: 871, range: 13450 },
            'A330-300': { name: '空客A330-300', cruiseSpeed: 871, range: 11750 },
            'A330neo-800': { name: '空客A330neo-800', cruiseSpeed: 871, range: 15094 },
            'A330neo-900': { name: '空客A330neo-900', cruiseSpeed: 871, range: 13334 },
            
            // 空客A340系列
            'A340-200': { name: '空客A340-200', cruiseSpeed: 885, range: 14800 },
            'A340-300': { name: '空客A340-300', cruiseSpeed: 885, range: 13500 },
            'A340-500': { name: '空客A340-500', cruiseSpeed: 885, range: 16670 },
            'A340-600': { name: '空客A340-600', cruiseSpeed: 885, range: 14630 },
            
            // 空客A350系列
            'A350-800': { name: '空客A350-800', cruiseSpeed: 871, range: 15100 },
            'A350-900': { name: '空客A350-900', cruiseSpeed: 871, range: 15000 },
            'A350-1000': { name: '空客A350-1000', cruiseSpeed: 871, range: 14800 },
            
            // 空客A380系列
            'A380-800': { name: '空客A380-800', cruiseSpeed: 907, range: 15200 },
            
            // 其他制造商
            'MD80': { name: '麦道MD-80', cruiseSpeed: 811, range: 3700 },
            'MD90': { name: '麦道MD-90', cruiseSpeed: 811, range: 3800 },
            'MD11': { name: '麦道MD-11', cruiseSpeed: 885, range: 12480 },
            'E170': { name: '巴西航空E170', cruiseSpeed: 829, range: 3334 },
            'E175': { name: '巴西航空E175', cruiseSpeed: 829, range: 3334 },
            'E190': { name: '巴西航空E190', cruiseSpeed: 829, range: 4448 },
            'E195': { name: '巴西航空E195', cruiseSpeed: 829, range: 4448 },
            'CRJ700': { name: '庞巴迪CRJ700', cruiseSpeed: 829, range: 3128 },
            'CRJ900': { name: '庞巴迪CRJ900', cruiseSpeed: 829, range: 2956 },
            'CRJ1000': { name: '庞巴迪CRJ1000', cruiseSpeed: 829, range: 2956 },
            'CS100': { name: '庞巴迪CS100 (A220-100)', cruiseSpeed: 871, range: 5900 },
            'CS300': { name: '庞巴迪CS300 (A220-300)', cruiseSpeed: 871, range: 6200 },
            'ATR42': { name: 'ATR 42', cruiseSpeed: 490, range: 1550 },
            'ATR72': { name: 'ATR 72', cruiseSpeed: 510, range: 1550 }
        };
        
        // 获取DOM元素
        const departureAirport = document.getElementById('departure-airport');
        const arrivalAirport = document.getElementById('arrival-airport');
        const drawBtn = document.getElementById('draw-btn');
        const historyList = document.getElementById('history-list');
        const departureCountrySelect = document.getElementById('departure-country');
        const arrivalCountrySelect = document.getElementById('arrival-country');
        const aircraftTypeSelect = document.getElementById('aircraft-type');
        const flightTimeDisplay = document.createElement('div');
        flightTimeDisplay.className = 'flight-time';
        flightTimeDisplay.style.marginTop = '20px';
        flightTimeDisplay.style.fontSize = '1.1rem';
        flightTimeDisplay.style.color = '#667eea';
        document.querySelector('.container').insertBefore(flightTimeDisplay, drawBtn.nextSibling);
        
        // 初始化国家选择下拉菜单
        function initCountrySelects() {
            // 添加"所有国家"选项
            const allOptionDeparture = document.createElement('option');
            allOptionDeparture.value = 'all';
            allOptionDeparture.textContent = '所有国家';
            departureCountrySelect.appendChild(allOptionDeparture);
            
            const allOptionArrival = document.createElement('option');
            allOptionArrival.value = 'all';
            allOptionArrival.textContent = '所有国家';
            arrivalCountrySelect.appendChild(allOptionArrival);
            
            // 添加各个国家选项
            countries.forEach(country => {
                const optionDeparture = document.createElement('option');
                optionDeparture.value = country;
                optionDeparture.textContent = country;
                departureCountrySelect.appendChild(optionDeparture);
                
                const optionArrival = document.createElement('option');
                optionArrival.value = country;
                optionArrival.textContent = country;
                arrivalCountrySelect.appendChild(optionArrival);
            });
        }
        
        // 历史记录数组
        let history = [];
        
        // 估算两个机场之间的距离（公里）
        function estimateDistance(departure, arrival) {
            // 如果是同一个国家的机场，假设平均距离为500公里
            if (departure.country === arrival.country) {
                return 500;
            }
            
            // 区域内国家之间的距离（亚洲内部、欧洲内部等）
            const regionalPairs = [
                { region1: '中国', region2: '日本', distance: 2500 },
                { region1: '中国', region2: '韩国', distance: 1000 },
                { region1: '中国', region2: '泰国', distance: 3000 },
                { region1: '中国', region2: '新加坡', distance: 4000 },
                { region1: '日本', region2: '韩国', distance: 1000 },
                { region1: '英国', region2: '法国', distance: 500 },
                { region1: '英国', region2: '德国', distance: 800 },
                { region1: '法国', region2: '德国', distance: 600 },
                { region1: '法国', region2: '西班牙', distance: 800 },
                { region1: '美国', region2: '加拿大', distance: 1500 }
            ];
            
            // 查找是否有预定义的区域距离
            for (const pair of regionalPairs) {
                if ((departure.country === pair.region1 && arrival.country === pair.region2) ||
                    (departure.country === pair.region2 && arrival.country === pair.region1)) {
                    return pair.distance;
                }
            }
            
            // 跨洲际的距离
            const intercontinentalPairs = [
                { continent1: ['中国', '日本', '韩国', '泰国', '新加坡', '印度'], continent2: ['英国', '法国', '德国', '荷兰', '西班牙', '意大利', '土耳其'], distance: 9000 },
                { continent1: ['中国', '日本', '韩国', '泰国', '新加坡', '印度'], continent2: ['美国', '加拿大'], distance: 11000 },
                { continent1: ['英国', '法国', '德国', '荷兰', '西班牙', '意大利', '土耳其'], continent2: ['美国', '加拿大'], distance: 6500 },
                { continent1: ['中国', '日本', '韩国', '泰国', '新加坡', '印度'], continent2: ['澳大利亚', '新西兰'], distance: 8500 },
                { continent1: ['美国', '加拿大'], continent2: ['澳大利亚', '新西兰'], distance: 12000 }
            ];
            
            // 查找跨洲际距离
            for (const pair of intercontinentalPairs) {
                const isInContinent1 = pair.continent1.includes(departure.country) || pair.continent1.includes(arrival.country);
                const isInContinent2 = pair.continent2.includes(departure.country) || pair.continent2.includes(arrival.country);
                
                if (isInContinent1 && isInContinent2 && departure.country !== arrival.country) {
                    return pair.distance;
                }
            }
            
            // 默认跨区域距离
            return 7000;
        }
        
        // 计算飞行时间
        function calculateFlightTime(departure, arrival, aircraftType) {
            const distance = estimateDistance(departure, arrival);
            const speed = aircraftTypes[aircraftType].cruiseSpeed;
            const flightTime = distance / speed;
            
            // 格式化时间显示
            const hours = Math.floor(flightTime);
            const minutes = Math.round((flightTime - hours) * 60);
            
            return { hours, minutes, distance };
        }
        
        // 抽签函数
        function drawRoute() {
            // 获取用户选择的国家
            const departureCountry = departureCountrySelect.value;
            const arrivalCountry = arrivalCountrySelect.value;
            // 如果用户没有选择机型或选择为空，默认使用波音737-300
            const aircraftType = aircraftTypeSelect.value || 'B737-300';
            
            // 根据选择的国家筛选机场
            let departureAirports = airports;
            let arrivalAirports = airports;
            
            if (departureCountry !== 'all') {
                departureAirports = airports.filter(airport => airport.country === departureCountry);
            }
            
            if (arrivalCountry !== 'all') {
                arrivalAirports = airports.filter(airport => airport.country === arrivalCountry);
            }
            
            // 确保筛选后有机场可选
            if (departureAirports.length === 0 || arrivalAirports.length === 0) {
                alert('所选国家没有可用的机场，请选择其他国家或使用"所有国家"选项。');
                return;
            }
            
            let departure, arrival, flightTimeInfo;
            let attempts = 0;
            const maxAttempts = 100; // 设置最大尝试次数以避免无限循环
            
            // 循环直到找到飞行时间不小于1小时的航线，或者达到最大尝试次数
            do {
                // 随机选择两个不同的机场（如果来自同一个国家，确保不是同一个机场）
                let departureIndex = Math.floor(Math.random() * departureAirports.length);
                let arrivalIndex;
                
                if (departureCountry === arrivalCountry && departureAirports.length > 1) {
                    do {
                        arrivalIndex = Math.floor(Math.random() * arrivalAirports.length);
                    } while (departureIndex === arrivalIndex);
                } else {
                    arrivalIndex = Math.floor(Math.random() * arrivalAirports.length);
                }
                
                departure = departureAirports[departureIndex];
                arrival = arrivalAirports[arrivalIndex];
                
                // 计算飞行时间
                flightTimeInfo = calculateFlightTime(departure, arrival, aircraftType);
                
                attempts++;
            } while ((flightTimeInfo.hours < 1 && flightTimeInfo.minutes < 60) && attempts < maxAttempts);
            
            // 如果达到最大尝试次数但仍未找到合适的航线，提示用户
            if (attempts >= maxAttempts) {
                alert('当前选择条件下难以找到飞行时间不小于1小时的航线，请尝试调整选择条件。');
                return;
            }
            
            // 添加动画效果更新机场显示
            updateAirportDisplay(departureAirport, departure);
            updateAirportDisplay(arrivalAirport, arrival);
            
            // 显示飞行时间
            displayFlightTime(flightTimeInfo, aircraftType);
            
            // 添加到历史记录
            addToHistory(departure, arrival, aircraftType, flightTimeInfo);
        }
        
        // 显示飞行时间
        function displayFlightTime(flightTimeInfo, aircraftType) {
            flightTimeDisplay.textContent = `${aircraftTypes[aircraftType].name} 预计飞行时间: ${flightTimeInfo.hours}小时${flightTimeInfo.minutes}分钟 (距离约${flightTimeInfo.distance}公里)`;
        }
        
        // 更新机场显示
        function updateAirportDisplay(element, airport) {
            // 添加过渡动画
            element.style.opacity = '0.5';
            setTimeout(() => {
                element.querySelector('.airport-code').textContent = airport.code;
                element.querySelector('.airport-name').textContent = `${airport.name} (${airport.country})`;
                element.style.opacity = '1';
            }, 300);
        }
        
        // 添加到历史记录
        function addToHistory(departure, arrival, aircraftType, flightTimeInfo) {
            const timestamp = new Date().toLocaleTimeString();
            const route = `${timestamp}: ${departure.code}(${departure.country}) → ${arrival.code}(${arrival.country}) [${aircraftTypes[aircraftType].name}: ${flightTimeInfo.hours}h${flightTimeInfo.minutes}m]`;
            history.unshift(route);
            
            // 限制历史记录数量
            if (history.length > 10) {
                history.pop();
            }
            
            // 更新历史记录显示
            updateHistoryDisplay();
        }
        
        // 更新历史记录显示
        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.textContent = item;
                historyList.appendChild(historyItem);
            });
        }
        
        // 添加点击事件监听器
        drawBtn.addEventListener('click', drawRoute);
        
        // 移除了登录相关变量和模态框元素引用
        
        // 初始化函数
        function initializeApp() {
            // 首先从本地数据库加载机场数据
            loadAirportsFromStorage();
            // 导入额外的机场数据（用户提供的中国机场列表）
            const importedCount = importAirports(additionalAirports);
            if (importedCount > 0) {
                console.log(`应用启动时导入了 ${importedCount} 个新机场`);
            }
            // 提取所有国家
            countries = [...new Set(airports.map(airport => airport.country))].sort();
            // 初始化国家选择下拉菜单
            initCountrySelects();
        }
        
        // 添加事件监听器
        function addEventListeners() {
            // 抽签按钮点击事件
            drawBtn.addEventListener('click', drawRoute);
        }
        
        // 页面加载时初始化
        window.addEventListener('load', () => {
            initializeApp();
            addEventListeners();
        });
    </script>
</body>
</html>